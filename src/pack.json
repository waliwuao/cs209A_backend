{
  "main/java/com/example/cs209a_project/dto/GroupMetrics.java": "package com.example.cs209a_project.dto;\n\npublic class GroupMetrics {\n    private String groupName;\n    private long totalQuestions;\n    \n    // 1. 基础文本指标\n    private double avgTitleLength;\n    private double avgBodyLength;\n    private double codeSnippetRate;\n    \n    // 2. 高级分析指标\n    private double avgReputation;      // 用户声望\n    private double avgTagsPerQuestion; // 话题复杂度\n    private double avgLinksPerQuestion;// 研究深度\n\n    public GroupMetrics(String groupName, long totalQuestions, \n                        double avgTitleLength, double avgBodyLength, double codeSnippetRate,\n                        double avgReputation, double avgTagsPerQuestion, double avgLinksPerQuestion) {\n        this.groupName = groupName;\n        this.totalQuestions = totalQuestions;\n        this.avgTitleLength = avgTitleLength;\n        this.avgBodyLength = avgBodyLength;\n        this.codeSnippetRate = codeSnippetRate;\n        this.avgReputation = avgReputation;\n        this.avgTagsPerQuestion = avgTagsPerQuestion;\n        this.avgLinksPerQuestion = avgLinksPerQuestion;\n    }\n\n    // Getters\n    public String getGroupName() { return groupName; }\n    public long getTotalQuestions() { return totalQuestions; }\n    public double getAvgTitleLength() { return avgTitleLength; }\n    public double getAvgBodyLength() { return avgBodyLength; }\n    public double getCodeSnippetRate() { return codeSnippetRate; }\n    public double getAvgReputation() { return avgReputation; }\n    public double getAvgTagsPerQuestion() { return avgTagsPerQuestion; }\n    public double getAvgLinksPerQuestion() { return avgLinksPerQuestion; }\n}\n",
  "main/java/com/example/cs209a_project/service/QuestionAnalysisService.java": "package com.example.cs209a_project.service;\n\nimport com.example.cs209a_project.dto.GroupMetrics;\nimport com.example.cs209a_project.dto.SolvabilityComparisonDTO;\nimport com.example.cs209a_project.model.Account;\nimport com.example.cs209a_project.model.Question;\nimport com.example.cs209a_project.model.QuestionTag;\nimport com.example.cs209a_project.repository.AccountRepository;\nimport com.example.cs209a_project.repository.QuestionRepository;\nimport com.example.cs209a_project.repository.QuestionTagRepository;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\n\nimport java.util.*;\nimport java.util.function.Predicate;\nimport java.util.stream.Collectors;\n\n@Service\npublic class QuestionAnalysisService {\n\n    @Autowired\n    private QuestionRepository questionRepository;\n\n    @Autowired\n    private AccountRepository accountRepository;\n\n    @Autowired\n    private QuestionTagRepository questionTagRepository;\n\n    public SolvabilityComparisonDTO analyzeSolvabilityFactors() {\n        List<Question> allQuestions = questionRepository.findAll();\n\n        // Group A: High Quality (Solved)\n        Predicate<Question> isHighQuality = q -> \n            q.getAnswerCount() != null && q.getAnswerCount() > 0 && q.getScore() != null && q.getScore() > 0;\n\n        // Group B: Hard to Solve (Unanswered/Low Score)\n        Predicate<Question> isHardToSolve = q -> \n            (q.getAnswerCount() == null || q.getAnswerCount() == 0) || (q.getScore() != null && q.getScore() <= 0);\n\n        List<Question> highQualityQuestions = allQuestions.stream().filter(isHighQuality).collect(Collectors.toList());\n        List<Question> hardQuestions = allQuestions.stream().filter(isHardToSolve).collect(Collectors.toList());\n\n        GroupMetrics highQualityMetrics = calculateMetrics(\"High Quality\", highQualityQuestions);\n        GroupMetrics hardMetrics = calculateMetrics(\"Hard to Solve\", hardQuestions);\n\n        String summary = String.format(\n            \"Comparitive analysis reveals: Solved questions have significantly higher user reputation (Avg: %.0f) and contain more context (Code Rate: %.1f%%, Links: %.1f) compared to unsolved ones.\",\n            highQualityMetrics.getAvgReputation(), \n            highQualityMetrics.getCodeSnippetRate() * 100,\n            highQualityMetrics.getAvgLinksPerQuestion()\n        );\n\n        return new SolvabilityComparisonDTO(highQualityMetrics, hardMetrics, summary);\n    }\n\n    private GroupMetrics calculateMetrics(String groupName, List<Question> questions) {\n        if (questions.isEmpty()) return new GroupMetrics(groupName, 0, 0, 0, 0, 0, 0, 0);\n\n        // 1. Text Metrics\n        double avgTitleLength = questions.stream().mapToInt(q -> q.getTitle() != null ? q.getTitle().length() : 0).average().orElse(0);\n        double avgBodyLength = questions.stream().mapToInt(q -> q.getBody() != null ? q.getBody().length() : 0).average().orElse(0);\n        long countWithCode = questions.stream().filter(q -> q.getBody() != null && (q.getBody().contains(\"<code>\") || q.getBody().contains(\"<pre>\"))).count();\n        double codeSnippetRate = (double) countWithCode / questions.size();\n\n        // 2. User Metrics (Batch Query)\n        Set<Integer> accountIds = questions.stream().map(Question::getAccountId).filter(Objects::nonNull).collect(Collectors.toSet());\n        Map<Integer, Integer> reputationMap = new HashMap<>();\n        if (!accountIds.isEmpty()) {\n            reputationMap = accountRepository.findAllById(accountIds).stream()\n                    .collect(Collectors.toMap(Account::getAccountId, a -> a.getReputation() != null ? a.getReputation() : 0));\n        }\n        final Map<Integer, Integer> finalRepMap = reputationMap;\n        double avgReputation = questions.stream().mapToInt(q -> finalRepMap.getOrDefault(q.getAccountId(), 0)).average().orElse(0);\n\n        // 3. Complexity Metrics\n        List<Integer> qIds = questions.stream().map(Question::getQuestionId).collect(Collectors.toList());\n        List<QuestionTag> tags = qIds.isEmpty() ? Collections.emptyList() : questionTagRepository.findByIdQuestionIdIn(qIds);\n        Map<Integer, Long> tagCounts = tags.stream().collect(Collectors.groupingBy(qt -> qt.getId().getQuestionId(), Collectors.counting()));\n        double avgTags = questions.stream().mapToLong(q -> tagCounts.getOrDefault(q.getQuestionId(), 0L)).average().orElse(0);\n\n        // 4. Research Metrics (Links)\n        double avgLinks = questions.stream().mapToDouble(q -> {\n            if (q.getBody() == null) return 0;\n            int count = 0, idx = 0;\n            while ((idx = q.getBody().indexOf(\"<a \", idx)) != -1) { count++; idx += 3; }\n            return count;\n        }).average().orElse(0);\n\n        return new GroupMetrics(groupName, questions.size(), avgTitleLength, avgBodyLength, codeSnippetRate, avgReputation, avgTags, avgLinks);\n    }\n}\n"
}